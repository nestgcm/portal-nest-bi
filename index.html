<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEST BI - Inteligência e Estatística</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@1,700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        /* --- VARIÁVEIS --- */
        :root {
            --bg-color: #f0f2f5;
            --header-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #1a252f;
            --text-secondary: #555;
            --accent-color: #003366; 
            --dourado: #b08d57;
            --card-bg: rgba(255, 255, 255, 0.9);
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow: 0 4px 15px rgba(0,0,0,0.05);
            --modal-bg: rgba(255, 255, 255, 0.98);
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --header-bg: rgba(20, 30, 45, 0.95);
            --text-primary: #e0e0e0;
            --text-secondary: #aaa;
            --accent-color: #4a90e2; 
            --dourado: #d4af37;
            --card-bg: rgba(30, 40, 60, 0.8);
            --border-color: rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
            --modal-bg: rgba(30, 40, 60, 0.98);
        }

        body {
            font-family: 'Montserrat', sans-serif; margin: 0; height: 100vh; overflow: hidden;
            background-color: var(--bg-color); color: var(--text-primary); transition: 0.3s;
        }

        /* --- BACKGROUND FIXO DO SISTEMA --- */
        #app-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('./imagens/bg-dashboard.jpg'); 
            background-size: cover; background-position: center; z-index: -2;
            filter: contrast(1.1) brightness(0.9);
        }
        #app-bg::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); opacity: 0.92; transition: background 0.3s;
        }

        /* --- MODAL GENÉRICO E DE ARQUIVOS --- */
        #custom-modal, #files-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 20000; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .ativo { opacity: 1 !important; pointer-events: all !important; }

        .modal-box {
            background: var(--modal-bg); width: 340px; padding: 30px;
            border-radius: 15px; text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            border: 1px solid var(--dourado); transform: scale(0.8); transition: transform 0.3s;
            max-height: 80vh; overflow-y: auto;
        }
        .ativo .modal-box { transform: scale(1); }

        .modal-icon { font-size: 40px; color: var(--dourado); margin-bottom: 15px; }
        .modal-title { font-size: 18px; font-weight: 700; margin: 0 0 10px 0; color: var(--text-primary); }
        .modal-desc { font-size: 14px; color: var(--text-secondary); margin-bottom: 25px; line-height: 1.5; }
        
        /* Lista de Arquivos */
        .file-list { display: flex; flex-direction: column; gap: 10px; text-align: left; margin-bottom: 20px; }
        .file-item {
            padding: 12px; background: rgba(0,0,0,0.05); border-radius: 8px;
            display: flex; align-items: center; gap: 10px; cursor: pointer;
            transition: 0.2s; color: var(--text-primary); text-decoration: none; font-size: 13px; font-weight: 600;
        }
        .file-item:hover { background: var(--accent-color); color: white; }
        .file-item i { font-size: 20px; color: var(--dourado); }
        .file-item:hover i { color: white; }

        .btn-modal {
            padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: 0.2s;
        }
        .btn-confirm { background: var(--accent-color); color: white; }
        .btn-confirm:hover { background: var(--dourado); }
        .btn-cancel { background: transparent; border: 1px solid var(--text-secondary); color: var(--text-primary); }
        .btn-cancel:hover { background: rgba(0,0,0,0.1); }

        /* --- LOGIN --- */
        #login-screen {
            position: fixed; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; background-size: cover; background-position: center; transition: background-image 1s ease-in-out;
        }
        #login-screen::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 20, 40, 0.7); z-index: -1;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2); padding: 40px 50px;
            border-radius: 15px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            text-align: center; width: 360px; color: white;
            animation: fadeIn 1s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .logo-img { width: 90px; margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.3)); }
        
        .titulo-gcm { font-size: 20px; margin: 0; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; line-height: 1.2; }
        .titulo-gerencia { font-size: 13px; margin: 8px 0 2px 0; font-weight: 600; color: #ddd; letter-spacing: 1px; text-transform: uppercase; }
        .titulo-nucleo { font-size: 11px; margin: 0 0 25px 0; color: var(--dourado); font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }

        /* Inputs de Login Melhorados */
        .input-wrapper {
            position: relative; width: 100%; margin: 10px 0;
        }
        .input-group input {
            width: 100%; padding: 15px; 
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255,255,255,0.3); border-radius: 8px; color: white;
            font-family: 'Montserrat', sans-serif; font-size: 16px; outline: none; transition: 0.3s; 
            text-align: center;
            box-sizing: border-box; 
        }
        
        /* Remove setinhas do number */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        input:focus { border-color: var(--dourado); background: rgba(0,0,0,0.6); }

        /* Ícone de ver senha */
        .toggle-password {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            color: rgba(255,255,255,0.7); cursor: pointer; font-size: 20px;
        }
        .toggle-password:hover { color: white; }

        .btn-login {
            width: 100%; padding: 15px; margin-top: 20px; background: var(--dourado);
            border: none; border-radius: 8px; color: white; font-weight: bold; font-size: 16px;
            cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-login:hover { background: #9e7c48; transform: scale(1.02); }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3); border-top: 3px solid var(--dourado);
            border-radius: 50%; width: 25px; height: 25px; animation: spin 1s linear infinite; margin: 20px auto 0; display: none;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- HEADER --- */
        header.top-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 70px;
            background: var(--header-bg); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px; box-sizing: border-box; z-index: 100; box-shadow: var(--shadow);
        }
        .brand { display: flex; align-items: center; gap: 15px; }
        .brand img { height: 40px; }
        .brand-text h2 { margin: 0; font-size: 18px; color: var(--accent-color); font-weight: 800; }
        .brand-text p { margin: 0; font-size: 11px; color: var(--text-secondary); font-weight: 600; letter-spacing: 1px; }

        .nav-menu { display: flex; align-items: center; gap: 15px; }
        .menu-btn {
            padding: 10px 15px; color: var(--text-secondary); cursor: pointer; border-radius: 6px;
            font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 6px; transition: 0.3s;
        }
        .menu-btn:hover, .menu-btn.active { background: var(--accent-color); color: white; }
        
        .dropdown { position: relative; }
        .dropdown-content {
            display: none; position: absolute; top: 100%; right: 0;
            background: var(--header-bg); min-width: 200px;
            box-shadow: var(--shadow); border-radius: 8px; padding: 10px 0; border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }
        .dropdown:hover .dropdown-content { display: block; }
        .dropdown-item {
            padding: 12px 20px; color: var(--text-secondary); cursor: pointer; transition: 0.2s; font-size: 13px; display: block;
        }
        .dropdown-item:hover { background: var(--accent-color); color: white; }

        .user-actions { display: flex; align-items: center; gap: 20px; margin-left: 20px; }
        .theme-toggle { cursor: pointer; font-size: 22px; color: var(--text-primary); transition: 0.3s; }
        .user-info-header { text-align: right; font-size: 12px; }
        .user-info-header strong { display: block; color: var(--accent-color); font-size: 14px; }
        .btn-sair-menu { color: #e74c3c; font-size: 20px; cursor: pointer; }
        .btn-sair-menu:hover { color: #c0392b; transform: scale(1.1); }

        /* --- CONTEÚDO --- */
        #app-container { opacity: 0; transition: opacity 1s; }
        .content-area { margin-top: 70px; height: calc(100vh - 70px); padding: 30px; box-sizing: border-box; overflow-y: auto; }

        #home-content { max-width: 950px; margin: 30px auto; animation: fadeIn 1s; }
        
        blockquote.quote-destaque {
            font-family: 'Playfair Display', serif; font-size: 26px; color: var(--dourado);
            font-style: italic; margin: 0 0 30px 0; padding: 0 20px; border-left: 4px solid var(--dourado); display: inline-block;
        }
        blockquote footer { font-size: 14px; color: var(--text-secondary); margin-top: 10px; font-family: 'Montserrat', sans-serif; font-style: normal; font-weight: 600; }

        .texto-inspirador { font-size: 16px; line-height: 1.8; color: var(--text-primary); text-align: justify; margin-bottom: 40px; }
        .highlight { color: var(--accent-color); font-weight: 700; }

        /* Links Úteis */
        .links-section h3, .badges-section h3 { color: var(--accent-color); font-size: 18px; border-bottom: 2px solid var(--dourado); display: inline-block; padding-bottom: 5px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        
        .links-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 40px; }
        .link-card {
            background: var(--card-bg); padding: 20px; border-radius: 10px; text-decoration: none; color: var(--text-primary);
            border: 1px solid var(--border-color); transition: 0.3s; display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 14px;
        }
        .link-card i { font-size: 24px; color: var(--dourado); }
        .link-card:hover { transform: translateY(-5px); border-color: var(--dourado); box-shadow: var(--shadow); }

        /* GRID DOS GRUPAMENTOS */
        .badges-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); 
            gap: 20px; 
            justify-items: center;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            border: 1px solid var(--border-color);
        }
        .badge-item {
            width: 80px; height: 80px;
            display: flex; justify-content: center; align-items: center;
            transition: 0.3s;
            filter: grayscale(20%);
        }
        .badge-item img {
            max-width: 100%; max-height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
        }
        .badge-item:hover {
            transform: scale(1.2);
            filter: grayscale(0%);
            z-index: 2;
        }

        .social-area { margin-top: 50px; display: flex; justify-content: center; align-items: center; gap: 10px; color: var(--dourado); font-weight: 600; }
        .social-area a { color: var(--dourado); text-decoration: none; display: flex; align-items: center; gap: 8px; transition: 0.3s; }

        #iframe-area {
            width: 100%; height: 100%; border-radius: 12px; overflow: hidden;
            background: var(--card-bg); border: 1px solid var(--border-color); display: none; box-shadow: var(--shadow); backdrop-filter: blur(5px);
        }
        iframe { width: 100%; height: 100%; border: none; }
        .oculto { display: none !important; }
    </style>
</head>
<body>
    <div id="app-bg"></div>

    <div id="custom-modal">
        <div class="modal-box">
            <i id="modal-icon" class="ph ph-info modal-icon"></i>
            <h3 id="modal-title" class="modal-title">Título</h3>
            <p id="modal-desc" class="modal-desc">Mensagem aqui.</p>
            <div id="modal-actions" class="modal-actions">
                <button class="btn-modal btn-confirm" onclick="fecharModal('custom-modal')">OK</button>
            </div>
        </div>
    </div>

    <div id="files-modal">
        <div class="modal-box">
            <i class="ph ph-folder-open modal-icon"></i>
            <h3 class="modal-title">Arquivos Disponíveis</h3>
            
            <div id="files-list" class="file-list">
                </div>

            <button class="btn-modal btn-cancel" onclick="fecharModal('files-modal')">Fechar</button>
        </div>
    </div>

    <div id="login-screen">
        <div class="login-card">
            <img src="./imagens/brasao_gcm.png" alt="Brasão" class="logo-img" onerror="this.style.display='none'">
            
            <h1 class="titulo-gcm">GUARDA CIVIL MUNICIPAL</h1>
            <h2 class="titulo-gerencia">GERÊNCIA ESTRATÉGICA DE GESTÃO</h2>
            <h3 class="titulo-nucleo">NÚCLEO DE ESTATÍSTICA E ANÁLISE CRIMINAL</h3>

            <div class="input-group">
                <div class="input-wrapper">
                    <input type="number" id="usuario" placeholder="Matrícula" pattern="\d*">
                </div>
                
                <div class="input-wrapper">
                    <input type="password" id="senha" placeholder="Senha" inputmode="numeric">
                    <i class="ph ph-eye-slash toggle-password" onclick="toggleSenha()"></i>
                </div>
            </div>

            <button id="btnLogin" class="btn-login" onclick="fazerLogin()">Acessar Portal</button>
            <div id="loading" class="spinner"></div>
        </div>
    </div>

    <div id="app-container" class="oculto">
        <header class="top-bar">
            <div class="brand">
                <img src="./imagens/brasao_gcm.png" alt="GCM" onerror="this.style.display='none'">
                <div class="brand-text">
                    <h2>NEST BI</h2>
                    <p>Inteligência que vê. Dados que protegem.</p>
                </div>
            </div>

            <nav class="nav-menu">
                <div class="menu-btn active" onclick="mostrarHome()">
                    <i class="ph ph-house"></i> Início
                </div>
                
                <div class="dropdown">
                    <div class="menu-btn">
                        <i class="ph ph-chart-bar"></i> Painéis <i class="ph ph-caret-down"></i>
                    </div>
                    <div class="dropdown-content">
                        <span class="dropdown-item" onclick="carregarBi('https://app.powerbi.com/view?r=eyJrIjoiNzhjNjNjNTktMWY2NS00MWI2LTk4YTItM2U2MGYwY2ExYjRmIiwidCI6IjNhYzIxOTMxLTdhMjQtNDQzYS1hNjZkLTQ4ODBmNTA4YWYyNyJ9')">GCMs Bahia</span>
                        <span class="dropdown-item" onclick="carregarBi('https://app.powerbi.com/view?r=eyJrIjoiNzk5ODhkYjAtNjEwOS00ODM3LWFmN2EtMmI4ZjdiMDNhODgyIiwidCI6IjNhYzIxOTMxLTdhMjQtNDQzYS1hNjZkLTQ4ODBmNTA4YWYyNyJ9')">Efetivo da GCM</span>
                        <span class="dropdown-item" onclick="carregarBi('https://app.powerbi.com/view?r=eyJrIjoiYWIxY2NkOTctMmM1Ni00Mzk0LTlkZTAtMjJkNjI2MThkMzhjIiwidCI6IjNhYzIxOTMxLTdhMjQtNDQzYS1hNjZkLTQ4ODBmNTA4YWYyNyJ9')">Inspetores</span>
			<span class="dropdown-item" onclick="carregarBi('https://app.powerbi.com/view?r=eyJrIjoiM2ExMzgxNmMtNzgyNy00NzA4LThiOWEtOTA2Mjk0MjhmNDY1IiwidCI6IjNhYzIxOTMxLTdhMjQtNDQzYS1hNjZkLTQ4ODBmNTA4YWYyNyJ9%22')">Galeria Ex-Superintendentes</span>

                    </div>
                </div>

                <div class="menu-btn" onclick="abrirModalArquivos()">
                    <i class="ph ph-folder"></i> Arquivos
                </div>

                <div class="menu-btn" onclick="document.getElementById('footer-social').scrollIntoView({behavior: 'smooth'})">
                    <i class="ph ph-whatsapp-logo"></i> Fale Conosco
                </div>
            </nav>

            <div class="user-actions">
                <i class="ph ph-sun theme-toggle" id="theme-btn" onclick="toggleTheme()"></i>
                <div class="user-info-header">
                    <strong id="display-nome">Usuário</strong>
                    <span id="display-cargo">Cargo</span>
                </div>
                <div class="btn-sair-menu" onclick="confirmarSaida()">
                    <i class="ph ph-sign-out"></i>
                </div>
            </div>
        </header>

        <div class="content-area">
            <div id="home-content">
                <div style="text-align: center;">
                    <blockquote class="quote-destaque">
                        "Meça o que é mensurável e torne mensurável o que não é."
                        <footer>— Galileo Galilei</footer>
                    </blockquote>
                    <div class="texto-inspirador">
                        <p><span class="highlight">Por trás de cada número, uma história preservada.</span></p>
                        <p>Salvador não é apenas uma cidade; é um organismo vivo, pulsante e complexo. No <strong>Núcleo de Estatística (NEST)</strong>, nós não apenas contamos ocorrências — nós interpretamos o ritmo da capital.</p>
                        <p>Onde outros veem gráficos, nós enxergamos o sorriso de quem curtiu a Virada em segurança. Onde há dados frios, nós projetamos o calor de um Carnaval de paz.</p>
                        <p>Da redução histórica no Centro Histórico à precisão científica debatida nacionalmente: nossa missão é traduzir a complexidade urbana em transparência e tranquilidade.</p>
                        <p style="text-align: center; font-weight: 700; margin-top: 30px; color: var(--dourado); letter-spacing: 1px;">
                            NEST GCM-SALVADOR. <br>Inteligência que vê. Dados que protegem.
                        </p>
                    </div>
                </div>

                <div class="links-section">
                    <h3>Links Úteis</h3>
                    <div class="links-grid">
                        <a href="https://salvador.ba.gov.br/" target="_blank" class="link-card">
                            <i class="ph ph-buildings"></i> Prefeitura de Salvador
                        </a>
                        <a href="https://transparencia.salvador.ba.gov.br/#" target="_blank" class="link-card">
                            <i class="ph ph-file-magnifying-glass"></i> Portal da Transparência
                        </a>
                        <a href="https://seguranca.sinesp.gov.br/sinesp-seguranca/login.jsf" target="_blank" class="link-card">
                            <i class="ph ph-shield-check"></i> SINESP Segurança
                        </a>
                    </div>
                </div>

                <div class="badges-section">
                    <h3>Grupamentos</h3>
                    <div class="badges-grid" id="badges-grid">
                        </div>
                </div>

                <div id="footer-social" class="social-area">
                    <a href="https://instagram.com/gcmsalvador" target="_blank">
                        <i class="ph ph-instagram-logo" style="font-size: 32px;"></i> 
                        <span>@gcmsalvador</span>
                    </a>
                </div>
            </div>

            <div id="iframe-area">
                <iframe id="bi-frame" src="" allowFullScreen="true"></iframe>
            </div>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwFWQRpMoHs_gdLzG2fyopq4wgT0rSrrvenMsDWitFz8D4vcqxRQGuL6ldzLHHwy9hq3Q/exec'; 

        // --- 1. CONFIGURAÇÃO DE ARQUIVOS PDF ---
        const listaArquivos = [
            { nome: "Operaçao Carnaval 2025", arquivo: "Operaçao Carnaval 2025.pdf" },
        ];

        function abrirModalArquivos() {
            const container = document.getElementById('files-list');
            container.innerHTML = ""; 

            if (listaArquivos.length === 0) {
                container.innerHTML = "<p style='color:#666'>Nenhum arquivo disponível.</p>";
            } else {
                listaArquivos.forEach(item => {
                    const link = document.createElement('a');
                    link.className = 'file-item';
                    link.href = `./arquivos/${item.arquivo}`;
                    link.target = "_blank"; 
                    link.innerHTML = `<i class="ph ph-file-pdf"></i> ${item.nome}`;
                    container.appendChild(link);
                });
            }
            document.getElementById('files-modal').classList.add('ativo');
        }

        // --- 2. CONFIGURAÇÃO DOS BRASÕES (TODOS PNG) ---
        const listaGrupamentos = [
            'gepa.png', 'gestg.png', 'maria_da_penha.png', 'gem.png', 
            'goe.png', 'goc.png', 'rondac.png', 'escolar.png', 
            'cprev.png', 'gat.png'
        ];

        function renderizarGrupamentos() {
            const container = document.getElementById('badges-grid');
            container.innerHTML = "";
            listaGrupamentos.forEach(imgNome => {
                const div = document.createElement('div');
                div.className = 'badge-item';
                div.innerHTML = `<img src="./imagens/${imgNome}" alt="Grupamento" onerror="this.style.display='none'">`;
                container.appendChild(div);
            });
        }
        document.addEventListener("DOMContentLoaded", renderizarGrupamentos);

        // --- 3. LÓGICA DE SENHA (TRAVA DE LETRAS) ---
        document.getElementById('senha').addEventListener('input', function (e) {
            // Substitui qualquer caractere que NÃO seja número (0-9) por nada
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        function toggleSenha() {
            const inputSenha = document.getElementById('senha');
            const icone = document.querySelector('.toggle-password');
            if (inputSenha.type === 'password') {
                inputSenha.type = 'text';
                icone.classList.replace('ph-eye-slash', 'ph-eye');
            } else {
                inputSenha.type = 'password';
                icone.classList.replace('ph-eye', 'ph-eye-slash');
            }
        }

        // --- LÓGICA DE MODAL GERAL ---
        function exibirModal(titulo, mensagem, tipo) {
            const modal = document.getElementById('custom-modal');
            const icon = document.getElementById('modal-icon');
            const actions = document.getElementById('modal-actions');
            document.getElementById('modal-title').innerText = titulo;
            document.getElementById('modal-desc').innerText = mensagem;
            
            if (tipo === 'erro') {
                icon.className = 'ph ph-warning-circle modal-icon';
                icon.style.color = '#e74c3c';
            } else if (tipo === 'info') {
                icon.className = 'ph ph-info modal-icon';
                icon.style.color = 'var(--dourado)';
            }
            actions.innerHTML = `<button class="btn-modal btn-confirm" onclick="fecharModal('custom-modal')">Entendi</button>`;
            modal.classList.add('ativo');
        }

        function fecharModal(id) {
            document.getElementById(id).classList.remove('ativo');
        }

        function confirmarSaida() {
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-title').innerText = "Encerrar Sessão";
            document.getElementById('modal-desc').innerText = "Tem certeza que deseja sair do sistema?";
            document.getElementById('modal-icon').className = 'ph ph-sign-out modal-icon';
            document.getElementById('modal-icon').style.color = '#e74c3c';
            const actions = document.getElementById('modal-actions');
            actions.innerHTML = `
                <button class="btn-modal btn-cancel" onclick="fecharModal('custom-modal')">Cancelar</button>
                <button class="btn-modal btn-confirm" onclick="location.reload()">Sair</button>
            `;
            modal.classList.add('ativo');
        }

        // --- TEMA E CARROSSEL ---
        function toggleTheme() {
            const html = document.documentElement;
            const themeBtn = document.getElementById('theme-btn');
            const newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            themeBtn.classList.replace(newTheme === 'dark' ? 'ph-sun' : 'ph-moon', newTheme === 'dark' ? 'ph-moon' : 'ph-sun');
            localStorage.setItem('nest-theme', newTheme);
        }
        const savedTheme = localStorage.getItem('nest-theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        if (savedTheme === 'dark') { document.getElementById('theme-btn').classList.replace('ph-sun', 'ph-moon'); }

        const loginImages = ['./imagens/bg-login.jpg', './imagens/bg-index.jpg', './imagens/bg-recuperar.jpg', './imagens/bg-primeiro.jpg', './imagens/bg-definir.jpg'];
        let currentImageIndex = 0;
        const loginScreen = document.getElementById('login-screen');
        function rotateLoginBackground() {
            let img = new Image();
            img.src = loginImages[currentImageIndex];
            img.onload = function() { loginScreen.style.backgroundImage = `url('${loginImages[currentImageIndex]}')`; }
            currentImageIndex = (currentImageIndex + 1) % loginImages.length;
        }
        rotateLoginBackground();
        setInterval(rotateLoginBackground, 5000);

        // --- LOGIN ---
        function fazerLogin() {
            const user = document.getElementById('usuario').value.trim();
            const pass = document.getElementById('senha').value.trim();
            const btn = document.getElementById('btnLogin');
            const spinner = document.getElementById('loading');

            if (!user || !pass) { exibirModal("Atenção", "Por favor, preencha a matrícula e a senha.", "erro"); return; }

            btn.style.display = 'none';
            spinner.style.display = 'block';

            fetch(scriptURL + '?user=' + encodeURIComponent(user) + '&pass=' + encodeURIComponent(pass))
            .then(res => res.json())
            .then(data => {
                if (data.status === 'sucesso') {
                    document.getElementById('display-nome').innerText = data.nome;
                    document.getElementById('display-cargo').innerText = data.cargo;
                    document.getElementById('login-screen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('login-screen').classList.add('oculto');
                        document.getElementById('app-container').classList.remove('oculto');
                        document.getElementById('app-container').style.opacity = '1';
                    }, 800);
                } else {
                    btn.style.display = 'block';
                    spinner.style.display = 'none';
                    exibirModal("Acesso Negado", "Matrícula ou senha incorretos.", "erro");
                }
            })
            .catch(e => {
                console.error(e);
                btn.style.display = 'block';
                spinner.style.display = 'none';
                exibirModal("Erro de Conexão", "Não foi possível conectar ao servidor.", "erro");
            });
        }

        // --- NAVEGAÇÃO ---
        function mostrarHome() {
            document.getElementById('iframe-area').style.display = 'none';
            document.getElementById('home-content').style.display = 'block';
            document.getElementById('bi-frame').src = "";
            document.querySelectorAll('.menu-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.menu-btn i.ph-house').parentElement.classList.add('active');
        }
        function carregarBi(link) {
            document.getElementById('home-content').style.display = 'none';
            const area = document.getElementById('iframe-area');
            area.style.display = 'block';
            document.getElementById('bi-frame').src = link;
            document.querySelectorAll('.menu-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.dropdown .menu-btn').classList.add('active');
        }
        document.getElementById('senha').addEventListener("keypress", function(event) {
            if (event.key === "Enter") fazerLogin();
        });
    </script>
</body>
</html>
