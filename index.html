<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEST BI - Inteligência e Estatística</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@1,700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        /* --- VARIÁVEIS TRANSCENDENTAIS --- */
        :root {
            --bg-color: #f4f7f9;
            --header-bg: rgba(255, 255, 255, 0.85);
            --text-primary: #1a252f;
            --text-secondary: #546e7a;
            --accent-color: #003366; 
            --dourado: #b08d57;
            --card-bg: rgba(255, 255, 255, 0.7);
            --border-color: rgba(176, 141, 87, 0.3);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --modal-bg: rgba(255, 255, 255, 0.95);
        }

        [data-theme="dark"] {
            --bg-color: #0a0e14;
            --header-bg: rgba(15, 23, 36, 0.85);
            --text-primary: #e1e8ed;
            --text-secondary: #94a3b8;
            --accent-color: #3b82f6; 
            --dourado: #d4af37;
            --card-bg: rgba(30, 41, 59, 0.6);
            --border-color: rgba(212, 175, 55, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            --modal-bg: rgba(15, 23, 36, 0.98);
        }

        body {
            font-family: 'Montserrat', sans-serif; margin: 0; height: 100vh; overflow: hidden;
            background-color: var(--bg-color); color: var(--text-primary); transition: background 0.5s ease;
        }

        /* --- BACKGROUND DINÂMICO --- */
        #app-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('./imagens/bg-dashboard.jpg'); 
            background-size: cover; background-position: center; z-index: -2;
        }
        #app-bg::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); opacity: 0.85; transition: 0.5s;
        }

        /* --- MODAIS --- */
        #custom-modal, #files-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
            z-index: 20000; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.4s;
        }
        .ativo { opacity: 1 !important; pointer-events: all !important; }

        .modal-box {
            background: var(--modal-bg); width: 360px; padding: 35px;
            border-radius: 20px; text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--dourado); transform: translateY(20px); transition: 0.4s;
            max-height: 80vh; overflow-y: auto;
        }
        .ativo .modal-box { transform: translateY(0); }

        /* --- LOGIN --- */
        #login-screen {
            position: fixed; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; background-size: cover; background-position: center; transition: 1s;
        }
        #login-screen::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(0, 20, 40, 0.85) 0%, rgba(0,0,0,0.6) 100%); z-index: -1;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2); padding: 50px;
            border-radius: 24px; box-shadow: 0 25px 50px rgba(0,0,0,0.6);
            text-align: center; width: 380px; color: white;
        }

        .input-group input {
            width: 100%; padding: 15px; margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; color: white;
            font-family: 'Montserrat', sans-serif; text-align: center; transition: 0.3s;
        }
        input:focus { border-color: var(--dourado); background: rgba(255,255,255,0.2); outline: none; }

        .btn-login {
            width: 100%; padding: 16px; background: var(--dourado);
            border: none; border-radius: 12px; color: white; font-weight: 700;
            cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 2px;
        }
        .btn-login:hover { background: #9c7a4b; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(176,141,87,0.4); }

        /* --- HEADER --- */
        header.top-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 80px;
            background: var(--header-bg); backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;
            padding: 0 40px; box-sizing: border-box; z-index: 100; box-shadow: var(--shadow);
        }
        .brand-text h2 { margin: 0; font-size: 20px; color: var(--accent-color); font-weight: 900; letter-spacing: 1px; }

        .menu-btn {
            padding: 12px 20px; color: var(--text-secondary); cursor: pointer; border-radius: 10px;
            font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: 0.3s;
        }
        .menu-btn:hover, .menu-btn.active { background: var(--accent-color); color: white; }

        /* --- ÁREA DO IFRAME (O SEGREDO DO VISUAL) --- */
        #iframe-area {
            width: 100%; height: 100%; border-radius: 20px; overflow: hidden;
            background: var(--card-bg); border: 1px solid var(--border-color); 
            display: none; box-shadow: var(--shadow); backdrop-filter: blur(10px);
            animation: slideUp 0.6s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        iframe { width: 100%; height: 100%; border: none; background: transparent; }

        /* Estilização da Home */
        .content-area { margin-top: 80px; height: calc(100vh - 80px); padding: 40px; box-sizing: border-box; overflow-y: auto; }
        .quote-destaque { font-family: 'Playfair Display', serif; font-size: 28px; color: var(--dourado); line-height: 1.4; }
        
        .badges-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 25px;
            padding: 30px; background: rgba(255,255,255,0.03); border-radius: 20px; border: 1px solid var(--border-color);
        }
        .badge-item img { transition: 0.4s; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3)); }
        .badge-item:hover img { transform: scale(1.25) rotate(5deg); }

    </style>
</head>
<body>
    <div id="app-bg"></div>

    <div id="custom-modal">
        <div class="modal-box">
            <i id="modal-icon" class="ph ph-info modal-icon" style="font-size: 48px; margin-bottom: 20px;"></i>
            <h3 id="modal-title" class="modal-title"></h3>
            <p id="modal-desc" class="modal-desc"></p>
            <div id="modal-actions"></div>
        </div>
    </div>

    <div id="files-modal">
        <div class="modal-box">
            <i class="ph ph-folder-open modal-icon" style="font-size: 48px; color: var(--dourado);"></i>
            <h3 class="modal-title">Biblioteca NEST</h3>
            <div id="files-list" style="margin: 20px 0; display: flex; flex-direction: column; gap: 12px;"></div>
            <button class="btn-modal btn-cancel" onclick="fecharModal('files-modal')" style="background:none; border: 1px solid var(--text-secondary); padding: 10px; border-radius: 8px; cursor: pointer; color: var(--text-primary);">Fechar</button>
        </div>
    </div>

    <div id="login-screen">
        <div class="login-card">
            <img src="./imagens/brasao_gcm.png" alt="Brasão" style="width: 100px; margin-bottom: 25px;">
            <h1 style="font-size: 18px; letter-spacing: 2px; margin-bottom: 5px;">GUARDA CIVIL MUNICIPAL</h1>
            <p style="color: var(--dourado); font-weight: 700; font-size: 12px; margin-bottom: 30px;">INTELIGÊNCIA E ESTATÍSTICA</p>

            <div class="input-group">
                <input type="number" id="usuario" placeholder="Matrícula" pattern="\d*">
                <div style="position: relative;">
                    <input type="password" id="senha" placeholder="Senha Numérica">
                    <i class="ph ph-eye-slash" onclick="toggleSenha()" style="position: absolute; right: 15px; top: 15px; cursor: pointer; opacity: 0.7;"></i>
                </div>
            </div>

            <button id="btnLogin" class="btn-login" onclick="fazerLogin()">Entrar</button>
            <div id="loading" class="spinner" style="display:none; margin-top: 20px; border: 3px solid rgba(255,255,255,0.3); border-top-color: var(--dourado); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite;"></div>
        </div>
    </div>

    <div id="app-container" style="display:none; opacity: 0; transition: 1s;">
        <header class="top-bar">
            <div class="brand">
                <div class="brand-text">
                    <h2>NEST BI</h2>
                    <p style="margin:0; font-size: 10px; letter-spacing: 1px; color: var(--text-secondary);">SALVADOR • BAHIA</p>
                </div>
            </div>

            <nav style="display: flex; gap: 10px;">
                <div class="menu-btn active" onclick="mostrarHome()"><i class="ph ph-house"></i> Início</div>
                
                <div style="position: relative;" class="dropdown-container">
                    <div class="menu-btn paineis-toggle"><i class="ph ph-chart-bar"></i> Painéis <i class="ph ph-caret-down"></i></div>
                    <div class="dropdown-content" style="display:none; position: absolute; top: 100%; background: var(--header-bg); min-width: 220px; border-radius: 12px; box-shadow: var(--shadow); padding: 10px; border: 1px solid var(--border-color); backdrop-filter: blur(20px);">
                        <div class="menu-btn" onclick="carregarBi('https://app.powerbi.com/view?r=eyJrIjoiNzhjNjNjNTktMWY2NS00MWI2LTk4YTItM2U2MGYwY2ExYjRmIiwidCI6IjNhYzIxOTMxLTdhMjQtNDQzYS1hNjZkLTQ4ODBmNTA4YWYyNyJ9')">GCMs Bahia</div>
                        <div class="menu-btn" onclick="carregarBi('https://app.powerbi.com/view?r=eyJrIjoiNzk5ODhkYjAtNjEwOS00ODM3LWFmN2EtMmI4ZjdiMDNhODgyIiwidCI6IjNhYzIxOTMxLTdhMjQtNDQzYS1hNjZkLTQ4ODBmNTA4YWYyNyJ9')">Efetivo Operacional</div>
                    </div>
                </div>

                <div class="menu-btn" onclick="abrirModalArquivos()"><i class="ph ph-folder"></i> Arquivos</div>
            </nav>

            <div style="display: flex; align-items: center; gap: 20px;">
                <i class="ph ph-sun theme-toggle" id="theme-btn" onclick="toggleTheme()" style="font-size: 24px; cursor: pointer;"></i>
                <div style="text-align: right;">
                    <strong id="display-nome" style="font-size: 14px; color: var(--accent-color);"></strong>
                    <div id="display-cargo" style="font-size: 10px; opacity: 0.7;"></div>
                </div>
                <i class="ph ph-sign-out" onclick="confirmarSaida()" style="font-size: 24px; color: #e74c3c; cursor: pointer;"></i>
            </div>
        </header>

        <div class="content-area">
            <div id="home-content">
                <div style="text-align: center; max-width: 800px; margin: 0 auto;">
                    <blockquote class="quote-destaque">
                        "Inteligência não é apenas coletar dados, é proteger o futuro através da análise do presente."
                    </blockquote>
                    <p style="line-height: 2; margin-top: 40px; font-size: 16px; opacity: 0.9;">
                        Bem-vindo ao Portal de Estatística da Guarda Civil Municipal de Salvador. 
                        Utilize o menu superior para acessar os indicadores estratégicos.
                    </p>
                    
                    <div class="badges-grid" id="badges-grid" style="margin-top: 60px;"></div>
                </div>
            </div>

            <div id="iframe-area">
                <iframe id="bi-frame" src=""></iframe>
            </div>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwFWQRpMoHs_gdLzG2fyopq4wgT0rSrrvenMsDWitFz8D4vcqxRQGuL6ldzLHHwy9hq3Q/exec';
        
        // Dropdown Logic
        document.querySelector('.paineis-toggle').onclick = (e) => {
            const content = document.querySelector('.dropdown-content');
            content.style.display = content.style.display === 'none' ? 'block' : 'none';
            e.stopPropagation();
        };
        window.onclick = () => document.querySelector('.dropdown-content').style.display = 'none';

        // Lógica de Senha
        function toggleSenha() {
            const p = document.getElementById('senha');
            const icon = p.nextElementSibling;
            p.type = p.type === 'password' ? 'text' : 'password';
            icon.classList.toggle('ph-eye');
            icon.classList.toggle('ph-eye-slash');
        }

        // Login
        function fazerLogin() {
            const user = document.getElementById('usuario').value;
            const pass = document.getElementById('senha').value;
            if(!user || !pass) return;

            document.getElementById('btnLogin').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            fetch(`${scriptURL}?user=${user}&pass=${pass}`)
                .then(r => r.json())
                .then(data => {
                    if(data.status === 'sucesso') {
                        document.getElementById('display-nome').innerText = data.nome;
                        document.getElementById('display-cargo').innerText = data.cargo;
                        document.getElementById('login-screen').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('login-screen').style.display = 'none';
                            document.getElementById('app-container').style.display = 'block';
                            setTimeout(() => document.getElementById('app-container').style.opacity = '1', 100);
                        }, 800);
                    } else {
                        alert("Acesso Negado");
                        document.getElementById('btnLogin').style.display = 'block';
                        document.getElementById('loading').style.display = 'none';
                    }
                });
        }

        // Navegação
        function carregarBi(url) {
            document.getElementById('home-content').style.display = 'none';
            document.getElementById('iframe-area').style.display = 'block';
            document.getElementById('bi-frame').src = url;
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.paineis-toggle').classList.add('active');
        }

        function mostrarHome() {
            document.getElementById('iframe-area').style.display = 'none';
            document.getElementById('home-content').style.display = 'block';
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('.ph-house').parentElement.classList.add('active');
        }

        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            html.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('theme-btn').classList.toggle('ph-sun');
            document.getElementById('theme-btn').classList.toggle('ph-moon');
        }

        // Brasões
        const listaGrupamentos = ['gepa.png', 'gestg.png', 'maria_da_penha.png', 'gem.png', 'goe.png', 'goc.png', 'rondac.png', 'escolar.png'];
        const grid = document.getElementById('badges-grid');
        listaGrupamentos.forEach(img => {
            const div = document.createElement('div');
            div.className = 'badge-item';
            div.innerHTML = `<img src="./imagens/${img}" style="width:80px">`;
            grid.appendChild(div);
        });

        function confirmarSaida() { if(confirm("Deseja sair?")) location.reload(); }
        function fecharModal(id) { document.getElementById(id).classList.remove('ativo'); }
        function abrirModalArquivos() { document.getElementById('files-modal').classList.add('ativo'); }
    </script>
</body>
</html>
